[tox]
envlist = py{39,310,311,312}, typecheck, lint, benchmark
minversion = 4.0
isolated_build = true

[testenv]
description = run tests with pytest
deps =
    pytest>=8.0
    pytest-cov
    hypothesis
commands =
    pytest {posargs:testing/ -v --tb=short}

[testenv:typecheck]
description = run type checking with mypy
deps =
    mypy>=1.0
    mypyc>=1.0
    types-setuptools
commands =
    mypy src/

[testenv:lint]
description = run linting with ruff
deps =
    ruff
commands =
    ruff check src/ testing/
    ruff format --check src/ testing/

[testenv:benchmark]
description = run performance benchmarks
deps =
    pytest>=8.0
    pytest-benchmark
commands =
    pytest testing/test_performance.py -v --benchmark-only

[testenv:build]
description = build with mypyc optimization
deps =
    build
    mypyc>=1.0
    mypy>=1.0
commands =
    python -m build

[testenv:coverage]
description = run tests with coverage
deps =
    pytest>=8.0
    pytest-cov
    hypothesis
commands =
    pytest testing/ --cov=fastpath --cov-report=term-missing --cov-report=html

[testenv:docs]
description = build documentation
deps =
    sphinx
    sphinx-rtd-theme
commands =
    sphinx-build -b html docs docs/_build/html

[gh-actions]
python =
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312